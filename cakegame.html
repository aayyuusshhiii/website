<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Princess Cake Game</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Comic Sans MS', cursive;
      background: linear-gradient(to bottom right, #ffe0f0, #ffd1ec);
      color: #d63384;
      overflow-x: hidden;
    }
    header {
      background-color: #ffc0cb;
      padding: 1rem;
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      color: white;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 1rem;
      background: #fff0f5;
      border-bottom: 3px solid #ffb6c1;
    }
    .toolbar button, .toolbar select, .toolbar input[type="color"] {
      margin: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #ffb6c1;
      color: white;
      cursor: pointer;
    }
    .toolbar button:hover { background-color: #ff69b4; }
    #canvasContainer {
      position: relative;
      width: 100%;
      height: calc(100vh - 150px);
      overflow: hidden;
      background-image: url('https://i.imgur.com/PWZMaV6.png');
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .cake-layer, .decoration, .cream-layer {
      position: absolute;
      cursor: move;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .cake-layer {
      width: 150px;
      height: 50px;
      background-color: pink;
      border: 2px solid white;
    }
    .decoration { width: 40px; height: 40px; }
    .cream-layer {
      width: 150px;
      height: 20px;
      background-color: white;
    }
    canvas {
      position: absolute;
      top: 0; left: 0;
      z-index: 10;
      pointer-events: none;
    }
    #drawingCanvas.active { pointer-events: auto; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>Princess Cake Game</header>
  <div class="toolbar">
    <button onclick="addCakeLayer()">Add Cake Layer</button>
    <select id="shapeSelector">
      <option value="rectangle">Rectangle</option>
      <option value="circle">Circle</option>
      <option value="oval">Oval</option>
      <option value="star">Star</option>
      <option value="square">Square</option>
    </select>
    <input type="color" id="colorPicker" value="#ffc0cb">
    <button onclick="addCreamLayer()">Add Cream</button>
    <button onclick="addDecoration('bow')">Add Bow</button>
    <button onclick="addDecoration('strawberry')">Add Strawberry</button>
    <button onclick="addDecoration('star')">Add Star</button>
    <button onclick="addDecoration('candle')">Add Candle</button>
    <button onclick="addDecoration('cherry')">Add Cherry</button>
    <button onclick="addDecoration('cookie')">Add Cookie</button>
    <button onclick="toggleDrawing()">Pencil</button>
    <button onclick="undoDraw()">Undo</button>
    <button onclick="eraseDraw()">Eraser</button>
    <button onclick="saveDesign()">Save Cake</button>
    <button onclick="toggle3D()">Toggle 3D/2D</button>
  </div>
  <div id="canvasContainer">
    <canvas id="drawingCanvas" width="1200" height="800"></canvas>
  </div>
<script>
  let isDrawing = false;
  let currentPath = [];
  let paths = [];
  let drawMode = false;

  const canvas = document.getElementById("drawingCanvas");
  const ctx = canvas.getContext("2d");

  function addCakeLayer() {
    const layer = document.createElement("div");
    const color = document.getElementById("colorPicker").value;
    const shape = document.getElementById("shapeSelector").value;

    layer.className = "cake-layer";
    layer.style.backgroundColor = color;
    layer.style.top = "300px";
    layer.style.left = "calc(50% - 75px)";
    setShape(layer, shape);
    makeDraggable(layer);
    document.getElementById("canvasContainer").appendChild(layer);
  }

  function addCreamLayer() {
    const cream = document.createElement("div");
    const color = document.getElementById("colorPicker").value;
    cream.className = "cream-layer";
    cream.style.backgroundColor = color;
    cream.style.top = "350px";
    cream.style.left = "calc(50% - 75px)";
    makeDraggable(cream);
    document.getElementById("canvasContainer").appendChild(cream);
  }

  function addDecoration(type) {
    const decor = document.createElement("div");
    decor.className = "decoration";
    decor
    
<!-- Include Three.js library -->
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
  let is3DView = false;
  let scene, camera, renderer, cakeGroup;

  function toggle3D() {
    is3DView = !is3DView;
    const container = document.getElementById("canvasContainer");

    if (is3DView) {
      // Hide 2D elements
      Array.from(container.children).forEach(child => {
        if (child !== canvas) child.style.display = "none";
      });
      canvas.style.display = "none";

      // Initialize Three.js scene
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.z = 500;

      renderer = new THREE.WebGLRenderer({ alpha: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      // Create cake group
      cakeGroup = new THREE.Group();

      // Convert 2D cake layers to 3D boxes
      document.querySelectorAll(".cake-layer").forEach(layer => {
        const color = layer.style.backgroundColor || "#ffc0cb";
        const geometry = new THREE.BoxGeometry(150, 50, 50);
        const material = new THREE.MeshPhongMaterial({ color });
        const mesh = new THREE.Mesh(geometry, material);
        mesh.position.set(
          parseInt(layer.style.left) - container.clientWidth / 2 + 75,
          -parseInt(layer.style.top) + container.clientHeight / 2 - 25,
          0
        );
        cakeGroup.add(mesh);
      });

      // Add light
      const light = new THREE.PointLight(0xffffff, 1, 1000);
      light.position.set(0, 0, 500);
      scene.add(light);

      scene.add(cakeGroup);

      // Start animation loop
      animate();
    } else {
      // Remove 3D renderer
      if (
