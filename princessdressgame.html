<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Barbie Princess Dress-Up</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Comic Sans MS', cursive;
      background: #f0e6ff;
      margin: 0;
      overflow-x: hidden;
      touch-action: manipulation;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    #barbie-area {
      position: relative;
      width: 300px;
      height: 500px;
      background: url('https://i.ibb.co/QFBNvd7/bg1.jpg') no-repeat center/cover;
      border: 4px solid #ffccff;
      border-radius: 20px;
      touch-action: none;
    }

    #barbie-img {
      width: 100%;
      position: absolute;
      bottom: 0;
      z-index: 1;
      user-select: none;
    }

    .item {
      position: absolute;
      z-index: 2;
      width: 100px;
      height: auto;
      touch-action: none;
      user-select: none;
      -webkit-user-drag: none;
      cursor: move;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
      gap: 10px;
    }

    .control-section {
      background: #fff0ff;
      padding: 10px;
      border-radius: 12px;
    }

    .color-picker {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
    }

    button {
      margin: 3px;
      padding: 8px;
      border: none;
      background: #ffc0cb;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background: #ff88aa;
    }

    canvas {
      display: none;
    }
  </style>
</head>
<body>

<div id="game-container">
  <div id="barbie-area">
    <img id="barbie-img" src="https://i.ibb.co/VxHbGbG/barbie-base.png" alt="Barbie">
  </div>

  <div id="controls">
    <div class="control-section">
      <h4>Dresses</h4>
      <button onclick="changeDress('https://i.ibb.co/yydYMGp/dress1.png')">One-piece</button>
      <button onclick="changeDress('https://i.ibb.co/N3rLXL1/dress2.png')">Two-piece</button>
    </div>

    <div class="control-section">
      <h4>Hair</h4>
      <button onclick="changeHair('https://i.ibb.co/f2F5F6k/hair1.png')">Style 1</button>
      <button onclick="changeHair('https://i.ibb.co/Br5Twv7/hair2.png')">Style 2</button>
      <input type="color" onchange="changeHairColor(this.value)">
    </div>

    <div class="control-section">
      <h4>Makeup</h4>
      <label>Eyeshadow</label><input type="color" onchange="applyMakeup('eyeshadow', this.value)"><br>
      <label>Lipstick</label><input type="color" onchange="applyMakeup('lipstick', this.value)"><br>
      <label>Blush</label><input type="color" onchange="applyMakeup('blush', this.value)">
    </div>

    <div class="control-section">
      <h4>Accessories</h4>
      <button onclick="addAccessory('hat', 'https://i.ibb.co/3dHdX2V/hat.png')">Hat</button>
      <button onclick="addAccessory('glasses', 'https://i.ibb.co/WxvvBqF/glasses.png')">Sunglasses</button>
      <button onclick="addAccessory('bag', 'https://i.ibb.co/86z5vsX/bag.png')">Handbag</button>
    </div>

    <div class="control-section">
      <h4>Background</h4>
      <button onclick="changeBackground('https://i.ibb.co/QFBNvd7/bg1.jpg')">Garden</button>
      <button onclick="changeBackground('https://i.ibb.co/FsxX3pN/bg2.jpg')">Palace</button>
    </div>

    <div class="control-section">
      <button onclick="undo()">Undo</button>
      <button onclick="reset()">Reset</button>
      <button onclick="saveImage()">Save Look</button>
    </div>
  </div>
</div>

<canvas id="canvas" width="300" height="500"></canvas>

<script>
  const barbieArea = document.getElementById('barbie-area');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const historyStack = [];

  function changeDress(src) {
    addOrReplace('dress', src);
  }

  function changeHair(src) {
    addOrReplace('hair', src);
  }

  function changeHairColor(color) {
    const hair = document.querySelector('.item.hair');
    if (hair) hair.style.filter = `hue-rotate(${getHueRotation(color)}deg)`;
  }

  function applyMakeup(type, color) {
    alert(`Pretend we applied ${type} in color ${color}!`);
  }

  function changeBackground(src) {
    barbieArea.style.backgroundImage = `url(${src})`;
  }

  function addAccessory(type, src) {
    const img = document.createElement('img');
    img.src = src;
    img.classList.add('item', type);
    img.style.left = '100px';
    img.style.top = '200px';
    makeDraggable(img);
    barbieArea.appendChild(img);
    historyStack.push(img);
  }

  function addOrReplace(type, src) {
    const existing = document.querySelector(`.item.${type}`);
    if (existing) existing.remove();
    const img = document.createElement('img');
    img.src = src;
    img.classList.add('item', type);
    img.style.left = '100px';
    img.style.top = '200px';
    makeDraggable(img);
    barbieArea.appendChild(img);
    historyStack.push(img);
  }

  function getHueRotation(hexColor) {
    const rgb = parseInt(hexColor.substring(1), 16);
    const r = (rgb >> 16) & 255;
    const g = (rgb >> 8) & 255;
    const b = rgb & 255;
    return ((Math.atan2(Math.sqrt(3) * (g - b), 2 * r - g - b) * 180) / Math.PI + 360) % 360;
  }

  function undo() {
    const last = historyStack.pop();
    if (last) last.remove();
  }

  function reset() {
    const items = document.querySelectorAll('.item');
    items.forEach(i => i.remove());
    historyStack.length = 0;
  }

  function saveImage() {
    html2canvas(barbieArea).then(canvas => {
      const link = document.createElement('a');
      link.download = 'barbie-look.png';
      link.href = canvas.toDataURL();
      link.click();
    });
  }

  function makeDraggable(el) {
    let isDragging = false;
    let offsetX, offsetY;

    const onStart = e => {
      isDragging = true;
      const rect = el.getBoundingClientRect();
      offsetX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      offsetY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
    };

    const onMove = e => {
      if (!isDragging) return;
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - offsetX - barbieArea.getBoundingClientRect().left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - offsetY - barbieArea.getBoundingClientRect().top;
      el.style.left = `${x}px`;
      el.style.top = `${y}px`;
    };

    const onEnd = () => {
      isDragging = false;
    };

    el.addEventListener('mousedown', onStart);
    el.addEventListener('mousemove', onMove);
    el.addEventListener('mouseup', onEnd);
    el.addEventListener('touchstart', onStart, { passive: true });
    el.addEventListener('touchmove', onMove, { passive: false });
    el.addEventListener('touchend', onEnd);
  }
</script>

<!-- Load html2canvas from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</body>
</html>
