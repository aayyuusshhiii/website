<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Princess Barbie Dress-Up</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive;
      background: linear-gradient(to bottom right, #ffe6f9, #ffe0ff);
      margin: 0;
      padding: 0;
      text-align: center;
    }

    #game-container {
      padding: 20px;
    }

    #barbie-area {
      position: relative;
      width: 300px;
      height: 500px;
      margin: 0 auto;
      background: url('https://i.ibb.co/QFBNvd7/bg1.jpg') no-repeat center/cover;
      border: 5px solid #ffb6c1;
      border-radius: 15px;
    }

    #barbie-img {
      position: absolute;
      width: 100%;
      bottom: 0;
      z-index: 1;
    }

    .draggable {
      position: absolute;
      width: 100px;
      cursor: move;
      z-index: 2;
    }

    .controls {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .controls button {
      background: #ffccff;
      border: none;
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
      font-size: 14px;
    }

    .controls button:hover {
      background: #ff99cc;
    }

    canvas {
      display: none;
    }
  </style>
</head>
<body>

<div id="game-container">
  <h2>Princess Barbie Dress-Up Game</h2>
  <div id="barbie-area">
    <img id="barbie-img" src="https://i.ibb.co/VxHbGbG/barbie-base.png" alt="Barbie">
  </div>

  <div class="controls">
    <button onclick="addItem('https://i.ibb.co/yydYMGp/dress1.png')">Dress</button>
    <button onclick="addItem('https://i.ibb.co/f2F5F6k/hair1.png')">Hair</button>
    <button onclick="addItem('https://i.ibb.co/3dHdX2V/hat.png')">Hat</button>
    <button onclick="addItem('https://i.ibb.co/WxvvBqF/glasses.png')">Glasses</button>
    <button onclick="addItem('https://i.ibb.co/86z5vsX/bag.png')">Handbag</button>
    <button onclick="undoItem()">Undo</button>
    <button onclick="resetScene()">Reset</button>
    <button onclick="saveScene()">Save</button>
  </div>

  <canvas id="save-canvas" width="300" height="500"></canvas>
</div>

<script>
  const barbieArea = document.getElementById("barbie-area");
  let history = [];

  function addItem(src) {
    const img = document.createElement("img");
    img.src = src;
    img.classList.add("draggable");
    img.style.left = "100px";
    img.style.top = "100px";

    enableDrag(img);
    barbieArea.appendChild(img);
    history.push(img);
  }

  function enableDrag(element) {
    let offsetX, offsetY, isDragging = false;

    const onStart = (e) => {
      isDragging = true;
      const rect = element.getBoundingClientRect();
      const event = e.touches ? e.touches[0] : e;
      offsetX = event.clientX - rect.left;
      offsetY = event.clientY - rect.top;
    };

    const onMove = (e) => {
      if (!isDragging) return;
      const event = e.touches ? e.touches[0] : e;
      const containerRect = barbieArea.getBoundingClientRect();
      element.style.left = `${event.clientX - containerRect.left - offsetX}px`;
      element.style.top = `${event.clientY - containerRect.top - offsetY}px`;
    };

    const onEnd = () => {
      isDragging = false;
    };

    element.addEventListener("mousedown", onStart);
    document.addEventListener("mousemove", onMove);
    document.addEventListener("mouseup", onEnd);

    element.addEventListener("touchstart", onStart);
    document.addEventListener("touchmove", onMove);
    document.addEventListener("touchend", onEnd);
  }

  function undoItem() {
    const last = history.pop();
    if (last) last.remove();
  }

  function resetScene() {
    history.forEach(el => el.remove());
    history = [];
  }

  function saveScene() {
    const canvas = document.getElementById("save-canvas");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const items = Array.from(barbieArea.querySelectorAll("img"));

    let loaded = 0;

    items.forEach(img => {
      const tempImg = new Image();
      tempImg.crossOrigin = "anonymous";
      tempImg.src = img.src;
      tempImg.onload = () => {
        const rect = img.getBoundingClientRect();
        const baseRect = barbieArea.getBoundingClientRect();
        const x = rect.left - baseRect.left;
        const y = rect.top - baseRect.top;
        ctx.drawImage(tempImg, x, y, img.width, img.height);
        loaded++;
        if (loaded === items.length) {
          const link = document.createElement("a");
          link.download = "princess-look.png";
          link.href = canvas.toDataURL();
          link.click();
        }
      };
    });
  }
</script>

</body>
</html>
